<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>

    <style>
      body {
        font-family: sans-serif;
        text-align: center;
      }

      .button-group {
        margin-top: 20px;
      }

      .range-button {
        padding: 8px 12px;
        margin: 5px;
        border: 1px solid #cfa96b;
        background-color: white;
        color: #cfa96b;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .range-button:hover,
      .range-button.active {
        background-color: #cfa96b;
        color: white;
      }

      .chart-container {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        align-items: center;
      }

      .chart-container .live-chart,
      .chart-container .history-chart {
        width: 60%;
        margin: 1rem;
        padding: 1rem;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }

      .live-price {
        margin: 1rem;
        padding: 1rem;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        width: 30%;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        font-size: 0.95rem;
        background-color: #fffdf7;
        border: 1px solid #e0cda9;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      th {
        background-color: #cfa96b;
        color: white;
        font-weight: 600;
        padding: 10px;
        text-align: center;
        font-size: 1rem;
      }

      td {
        padding: 10px;
        border-top: 1px solid #e0cda9;
        text-align: left;
        color: #333;
      }

      .live-price table + table {
        margin-top: 1rem;
      }

      td:nth-child(2),
      td:nth-child(3) {
        text-align: right;
      }

      tr:hover td {
        background-color: #fff3e0;
      }

      @media screen and (max-width: 768px) {
        .chart-container {
          flex-direction: column;
          align-items: center;
        }

        .chart-container .live-chart,
        .chart-container .history-chart {
          width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <div class="chart-container">
      <div class="live-price"></div>
      <div class="live-chart">
        <canvas id="myChart"></canvas>

        <!-- <div class="button-group">
          <button
            class="range-button active"
            data-range="live">
            Live
          </button>
          <button
            class="range-button"
            data-range="1d">
            1D
          </button>
          <button
            class="range-button"
            data-range="1w">
            1W
          </button>
          <button
            class="range-button"
            data-range="1m">
            1M
          </button>
          <button
            class="range-button"
            data-range="3m">
            3M
          </button>
          <button
            class="range-button"
            data-range="6m">
            6M
          </button>
          <button
            class="range-button"
            data-range="ytd">
            YTD
          </button>
          <button
            class="range-button"
            data-range="1y">
            1Y
          </button>
          <button
            class="range-button"
            data-range="5y">
            5Y
          </button>
        </div> -->
      </div>
    </div>
    <div class="chart-container">
      <div class="history-chart">
        <canvas id="tenYearChart"></canvas>
      </div>
    </div>

    <script>
      const ctx = document.getElementById('myChart').getContext('2d');
      const barCtx = document
        .getElementById('tenYearChart')
        .getContext('2d');

      const xValues = [
        '04/10',
        '04/11',
        '04/14',
        '04/15',
        '04/16',
        '04/17',
        '04/22',
      ];
      const yValues = [
        3127.785, 3235.205, 3200.95, 3219.315, 3315.075, 3298.205,
        3397.64,
      ];

      const yearLabels = [
        '2015',
        '2016',
        '2017',
        '2018',
        '2019',
        '2020',
        '2021',
        '2022',
        '2023',
        '2024',
        '2025',
      ];

      const yearPrices = [
        1298, 1373, 1351, 1360, 1543, 2058, 1954, 2043, 2115, 2786,
        3436,
      ];

      const myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [...xValues],
          datasets: [
            {
              fill: true,
              lineTension: 0,
              backgroundColor: 'rgba(207,169,107,0.2)',
              borderColor: 'rgba(207,169,107,1)',
              borderWidth: 2,
              pointRadius: 2,
              pointBackgroundColor: function (ctx) {
                return ctx.dataIndex === yValues.length - 1
                  ? 'rgba(255, 0, 0, 1)'
                  : 'rgba(207,169,107,1)';
              },
              data: [...yValues],
            },
          ],
        },
        options: {
          plugins: {
            datalabels: {
              display: false,
            },
          },
          animation: false,
          title: {
            display: true,
            text: 'Live Gold Price (USD/oz)',
            fontSize: 16,
          },
          legend: { display: false },
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: false,
                  suggestedMin: 3000,
                  suggestedMax: 3500,
                },
              },
            ],
          },
        },
      });

      new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: yearLabels,
          datasets: [
            {
              label: 'Gold Price (USD/oz)',
              data: yearPrices,
              backgroundColor: 'rgba(207,169,107,0.8)',
              borderColor: 'rgba(207,169,107,1)',
              borderWidth: 1,
            },
          ],
        },
        options: {
          plugins: {
            datalabels: {
              color: '#000',
              anchor: 'end',
              align: 'end',
              font: {
                weight: 'bold',
              },
              formatter: function (value) {
                return `$${value.toFixed(2)}`;
              },
            },
          },
          title: {
            display: true,
            text: 'Gold Price Increase Over the Last 10 Years',
            fontSize: 16,
          },
          legend: {
            display: false,
          },
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: false,
                  suggestedMin: 1000,
                  suggestedMax: 4000,
                  callback: function (value) {
                    return `$${value.toLocaleString(undefined, {
                      minimumFractionDigits: 2,
                    })}`;
                  },
                },
              },
            ],
          },
        },
        plugins: [Chart.plugins.getAll().concat(ChartDataLabels)],
      });

      // Glowing effect on last point
      let radius = 4;
      const maxRadius = 20;
      setInterval(() => {
        const meta = myChart.getDatasetMeta(0);
        const lastPoint =
          meta.data[myChart.data.datasets[0].data.length - 1];
        const ctx = myChart.ctx;

        myChart.update();

        const opacity = 1 - (radius - 4) / (maxRadius - 4);
        ctx.save();
        ctx.beginPath();
        ctx.arc(
          lastPoint._model.x,
          lastPoint._model.y,
          radius,
          0,
          2 * Math.PI
        );
        ctx.fillStyle = `rgba(207,169,107, ${opacity.toFixed(2)})`;
        ctx.fill();
        ctx.restore();

        radius += 1;
        if (radius > maxRadius) radius = 4;
      }, 100);

      // Simulate "Live" updates every 10 seconds (mock)
      setInterval(() => {
        const now = new Date();
        const label = now.toLocaleDateString('en-US', {
          month: '2-digit',
          day: '2-digit',
        });
        const newValue = 3100 + Math.random() * 400;

        xValues.push(label);
        yValues.push(parseFloat(newValue.toFixed(2)));

        if (xValues.length > 30) {
          xValues.shift();
          yValues.shift();
        }

        myChart.data.labels = [...xValues];
        myChart.data.datasets[0].data = [...yValues];
        myChart.update();
      }, 1000); // 10s for demo

      // Button behavior
      const buttons = document.querySelectorAll('.range-button');
      buttons.forEach((button) => {
        button.addEventListener('click', () => {
          buttons.forEach((btn) => btn.classList.remove('active'));
          button.classList.add('active');

          const range = button.getAttribute('data-range');
          console.log('Selected Range:', range);

          // TODO: Replace this with real data fetching per range
          // Example: fetchAndUpdateChart(range);
        });
      });
    </script>

    <script>
      const API_KEY = 'f7310b277b44abb93d91fc3e62481199'; // replace with your real API key

      async function fetchLiveGoldData() {
        const goldPriceByCarat = await fetch(
          `https://api.metalpriceapi.com/v1/carat?api_key=${API_KEY}&base=USD`
        );
        const usdToInr = await fetch(
          `https://api.metalpriceapi.com/v1/latest?api_key=${API_KEY}&base=USD&currencies=INR`
        );

        const goldPriceByCaratData = await goldPriceByCarat.json();
        const usdToInrData = await usdToInr.json();

        console.log(goldPriceByCaratData);
        console.log(usdToInrData);

        let goldMasterData = [
          {
            Karat: '24k',
            oneGramUsd: goldPriceByCaratData.data['24k'] * 5,
            tenGramUsd: goldPriceByCaratData.data['24k'] * 5 * 10,
            oneTolaUsd: goldPriceByCaratData.data['24k'] * 5 * 11.66,
            oneOunceUsd: goldPriceByCaratData.data['24k'] * 5 * 31.1,
            oneGramInr:
              goldPriceByCaratData.data['24k'] *
              5 *
              usdToInrData.rates.INR,
            tenGramInr:
              goldPriceByCaratData.data['24k'] *
              5 *
              10 *
              usdToInrData.rates.INR,
            oneTolaInr:
              goldPriceByCaratData.data['24k'] *
              5 *
              11.66 *
              usdToInrData.rates.INR,
            oneOunceInr:
              goldPriceByCaratData.data['24k'] *
              5 *
              31.1 *
              usdToInrData.rates.INR,
          },
          {
            Karat: '22k',
            oneGramUsd: goldPriceByCaratData.data['22k'] * 5,
            tenGramUsd: goldPriceByCaratData.data['22k'] * 5 * 10,
            oneTolaUsd: goldPriceByCaratData.data['22k'] * 5 * 11.66,
            oneOunceUsd: goldPriceByCaratData.data['22k'] * 5 * 31.1,
            oneGramInr:
              goldPriceByCaratData.data['22k'] *
              5 *
              usdToInrData.rates.INR,
            tenGramInr:
              goldPriceByCaratData.data['22k'] *
              5 *
              10 *
              usdToInrData.rates.INR,
            oneTolaInr:
              goldPriceByCaratData.data['22k'] *
              5 *
              11.66 *
              usdToInrData.rates.INR,
            oneOunceInr:
              goldPriceByCaratData.data['22k'] *
              5 *
              31.1 *
              usdToInrData.rates.INR,
          },
          {
            Karat: '18k',
            oneGramUsd: goldPriceByCaratData.data['18k'] * 5,
            tenGramUsd: goldPriceByCaratData.data['18k'] * 5 * 10,
            oneTolaUsd: goldPriceByCaratData.data['18k'] * 5 * 11.66,
            oneOunceUsd: goldPriceByCaratData.data['18k'] * 5 * 31.1,
            oneGramInr:
              goldPriceByCaratData.data['18k'] *
              5 *
              usdToInrData.rates.INR,
            tenGramInr:
              goldPriceByCaratData.data['18k'] *
              5 *
              10 *
              usdToInrData.rates.INR,
            oneTolaInr:
              goldPriceByCaratData.data['18k'] *
              5 *
              11.66 *
              usdToInrData.rates.INR,
            oneOunceInr:
              goldPriceByCaratData.data['18k'] *
              5 *
              31.1 *
              usdToInrData.rates.INR,
          },
        ];

        let html = '';

        for (let i = 0; i < goldMasterData.length; i++) {
          const data = goldMasterData[i];
          html += `
        <table>
          <tr>
            <th colspan="3">${data.Karat}t Gold Price</th>
          </tr>
          <tr>
            <td>1 Ounce</td>
            <td>$${data.oneOunceUsd}</td>
            <td>₹${data.oneOunceInr}</td>
          </tr>
          <tr>
            <td>10 gram</td>
            <td>$${data.tenGramUsd}</td>
            <td>₹${data.tenGramInr}</td>
          </tr>
          <tr>
            <td>1 Tola (11.66 Grams)</td>
              <td>$${data.oneTolaUsd}</td>
            <td>₹${data.oneTolaInr}</td>
          </tr>
          <tr>
            <td>1 gram</td>
              <td>$${data.oneGramUsd}</td>
            <td>₹${data.oneGramInr}</td>
          </tr>
        </table>
          `;
        }

        document.querySelector('.live-price').innerHTML = html;

        console.log(goldMasterData);
      }

      // Fetch live data on load
      fetchLiveGoldData();
    </script>
  </body>
</html>
