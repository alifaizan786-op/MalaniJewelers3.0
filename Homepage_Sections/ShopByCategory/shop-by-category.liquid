{% schema %}
{
  "name": "Shop By Category",
  "settings": [],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "select",
          "id": "group",
          "label": "Group",
          "options": [
            { "value": "women", "label": "Women" },
            { "value": "men", "label": "Men" },
            { "value": "kids", "label": "Kids" }
          ],
          "default": "women"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Category Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Image Alt Text"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Category Title"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link to Collection/Page"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop By Category",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<section class="shop-by-category">
  <h2>Shop By Category</h2>
  <div class="toggle-container">
    <div class="toggle" id="categoryToggle">
      <div class="option" data-category="men">Men</div>
      <div class="option active" data-category="women">Women</div>
      <div class="option" data-category="kids">Kids</div>
      <div class="slider" style="left: 33.3333%"></div>
    </div>
  </div>

  {% assign groups = 'women,men,kids' | split: ',' %}
  {% for group in groups %}
    <div class="owl-carousel category-carousel" id="{{ group }}">
      {% for block in section.blocks %}
        {% if block.settings.group == group %}
          <div>
            <a href="{{ block.settings.link }}">
              <img
                src="{{ block.settings.image | image_url }}"
                alt="{{ block.settings.alt_text | escape }}"
                width="300"
                height="300"
              >
              {% if block.settings.title != blank %}
                <h3 class="category-title">{{ block.settings.title }}</h3>
              {% endif %}
            </a>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endfor %}
</section>

<script>
  $(document).ready(function () {
    $('.owl-carousel').owlCarousel({
      loop: true,
      margin: 30,
      autoplay: true,
      autoplayTimeout: 3000,
      smartSpeed: 600,
      responsive: {
        0: { items: 1, margin: 16 },
        480: { items: 2 },
        768: { items: 3 },
        1024: { items: 4 },
      },
    });

    $('.category-carousel').removeClass('fade-in').hide();
    const $default = $('#women');
    $default.show();
    setTimeout(() => $default.addClass('fade-in'), 10);

    const options = document.querySelectorAll('.option');
    const slider = document.querySelector('.slider');
    options.forEach((option, index) => {
      option.addEventListener('click', () => {
        options.forEach((opt) => opt.classList.remove('active'));
        option.classList.add('active');
        slider.style.left = `${index * 33.3333}%`;

        const selectedCategory = option.getAttribute('data-category');
        $('.category-carousel').removeClass('fade-in').hide();
        const $selected = $(`#${selectedCategory}`);
        $selected.show();
        setTimeout(() => $selected.addClass('fade-in'), 10);
      });
    });
  });
</script>

<style>
  @font-face {
    font-family: 'Abhaya Libre';
    src: url('http://malanijewelers.myshopify.com/cdn/shop/t/2/assets/AbhayaLibre-Regular.ttf') format('truetype');
    font-weight: 400;
    font-style: normal;
  }

  @font-face {
    font-family: 'Abhaya Libre';
    src: url('http://malanijewelers.myshopify.com/cdn/shop/t/2/assets/AbhayaLibre-Medium.ttf') format('truetype');
    font-weight: 500;
    font-style: normal;
  }

  @font-face {
    font-family: 'Abhaya Libre';
    src: url('http://malanijewelers.myshopify.com/cdn/shop/t/2/assets/AbhayaLibre-SemiBold.ttf') format('truetype');
    font-weight: 600;
    font-style: normal;
  }

  @font-face {
    font-family: 'Abhaya Libre';
    src: url('http://malanijewelers.myshopify.com/cdn/shop/t/2/assets/AbhayaLibre-Bold.ttf') format('truetype');
    font-weight: 700;
    font-style: normal;
  }

  @font-face {
    font-family: 'Abhaya Libre';
    src: url('http://malanijewelers.myshopify.com/cdn/shop/t/2/assets/AbhayaLibre-ExtraBold.ttf') format('truetype');
    font-weight: 800;
    font-style: normal;
  }

  .shop-by-category {
    background: linear-gradient(180deg, #f9faf7 0%, #f8f8f8 21.63%);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    flex-direction: column;
    padding: 1rem;
  }

  .shop-by-category h2 {
    color: #000;
    text-align: center;
    font-family: 'Abhaya Libre';
    font-size: 3rem;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
    letter-spacing: 0.075rem;
    margin: 0;
  }

  .toggle-container {
    text-align: center;
  }

  .toggle {
    position: relative;
    display: flex;
    background: #fff;
    border: 2px solid #fff;
    border-radius: 30px;
    overflow: hidden;
    width: 300px;
    height: 40px;
    cursor: pointer;
  }

  .option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    z-index: 2;
    transition: color 0.3s;
    user-select: none;
    position: relative;
  }

  .option.active {
    color: #fff;
    font-weight: bold;
  }

  .slider {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 33.3333%;
    background: #000;
    transition: left 0.3s ease;
    z-index: 1;
    border-radius: 30px;
  }

  .category-carousel {
    display: none;
    opacity: 0;
    transform: scale(0.98);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .category-carousel.fade-in {
    display: block !important;
    opacity: 1;
    transform: scale(1);
  }

  .category-carousel h3.category-title {
    text-align: center;
    font-family: 'Abhaya Libre';
    margin-top: 0.5rem;
    font-size: 1.1rem;
    color: #333;
  }

  .category-carousel a {
    text-decoration: none;
  }

  @media (max-width: 767px) {
    .shop-by-category h2 {
      font-size: 2rem;
    }
  }
</style>
