<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Your Order is Out for Delivery</title>
    <style>
      @media only screen and (max-width: 600px) {
        table {
          width: 100% !important;
        }
        h1 {
          font-size: 2rem !important;
        }
        h2,
        h3,
        p,
        td {
          font-size: 1rem !important;
        }
        img {
          max-width: 100% !important;
          height: auto !important;
        }
        .btn {
          display: block !important;
          margin: 1rem auto !important;
          width: 90% !important;
          text-align: center !important;
        }
      }
    </style>
  </head>
  <body
    style="
      margin: 0;
      padding: 0;
      font-family: 'Abhaya Libre', serif;
      background-color: #f5f5f5;
      color: #333;
    ">
    <section style="padding: 2rem 0">
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
          border-radius: 15px 15px 0 0;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        ">
        <tr align="center">
          <td style="padding: 2rem">
            <img
              src="https://cdn.shopify.com/s/files/1/0930/1200/1051/files/Logo_Email.svg?v=1750363896"
              alt="{{ shop.name }} Logo"
              style="width: 100%; max-width: 700px; height: auto" />
          </td>
        </tr>
        <tr align="center">
          <td style="padding: 1rem 0">
            <!-- SVG ICON - Delivery Truck with House -->
            <svg
              width="150"
              height="150"
              viewBox="0 0 200 200">
              <style>
                .truck-body {
                  stroke: #212121;
                  fill: #fff;
                  stroke-width: 4;
                }
                .truck-accent {
                  stroke: #cfa96b;
                  fill: #cfa96b;
                  stroke-width: 2;
                }
                .wheel {
                  stroke: #212121;
                  fill: #333;
                  stroke-width: 3;
                }
                .house {
                  stroke: #28a745;
                  fill: #e8f5e8;
                  stroke-width: 3;
                }
                .motion-line {
                  stroke: #cfa96b;
                  stroke-width: 3;
                  stroke-linecap: round;
                }
                .sparkle {
                  fill: #cfa96b;
                }
              </style>
              <!-- House destination -->
              <rect x="130" y="90" width="30" height="25" class="house"/>
              <polygon points="130,90 145,75 160,90" class="house"/>
              <rect x="140" y="105" width="8" height="10" class="house"/>
              <!-- Delivery truck -->
              <rect x="40" y="80" width="35" height="40" class="truck-body"/>
              <rect x="75" y="90" width="45" height="30" class="truck-body"/>
              <!-- Truck details -->
              <rect x="44" y="85" width="27" height="12" class="truck-accent"/>
              <rect x="79" y="95" width="37" height="6" class="truck-accent"/>
              <!-- Wheels with motion -->
              <circle cx="57" cy="135" r="10" class="wheel"/>
              <circle cx="100" cy="135" r="10" class="wheel"/>
              <!-- Motion lines -->
              <line x1="15" y1="70" x2="30" y2="70" class="motion-line"/>
              <line x1="10" y1="85" x2="25" y2="85" class="motion-line"/>
              <line x1="20" y1="100" x2="35" y2="100" class="motion-line"/>
              <!-- Direction arrow -->
              <polygon points="120,95 125,90 125,92 135,92 135,98 125,98 125,100" class="truck-accent"/>
              <!-- Sparkles for excitement -->
              <polygon points="170,45 172,50 177,50 173,53 175,58 170,55 165,58 167,53 163,50 168,50" class="sparkle"/>
              <polygon points="25,50 27,55 32,55 28,58 30,63 25,60 20,63 22,58 18,55 23,55" class="sparkle"/>
            </svg>
          </td>
        </tr>
      </table>

      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
        ">
        <tr align="center">
          <td style="padding: 1rem">
            {% if fulfillment.item_count == item_count %}
              <h1 style="color: #cfa96b; font-size: 2.5rem; margin: 0">
                Out for Delivery! 🚚
              </h1>
              <p style="font-size: 1.25rem; margin: 0.5rem 0; color: #28a745; font-weight: bold;">
                Your order is out for delivery and on its way to you!
              </p>
            {% elsif fulfillment.item_count > 1 %}
              {% if fulfillment_status == 'fulfilled' %}
                <h1 style="color: #cfa96b; font-size: 2.5rem; margin: 0">
                  Final Items Delivering! 🚚
                </h1>
                <p style="font-size: 1.25rem; margin: 0.5rem 0; color: #28a745; font-weight: bold;">
                  The last items in your order are out for delivery!
                </p>
              {% else %}
                <h1 style="color: #cfa96b; font-size: 2.5rem; margin: 0">
                  Partial Delivery Today! 🚚
                </h1>
                <p style="font-size: 1.25rem; margin: 0.5rem 0; color: #28a745; font-weight: bold;">
                  Some items in your order are out for delivery!
                </p>
              {% endif %}
            {% else %}
              {% if fulfillment_status == 'fulfilled' %}
                <h1 style="color: #cfa96b; font-size: 2.5rem; margin: 0">
                  Final Item Delivering! 🚚
                </h1>
                <p style="font-size: 1.25rem; margin: 0.5rem 0; color: #28a745; font-weight: bold;">
                  The last item in your order is out for delivery!
                </p>
              {% else %}
                <h1 style="color: #cfa96b; font-size: 2.5rem; margin: 0">
                  Almost There! 🚚
                </h1>
                <p style="font-size: 1.25rem; margin: 0.5rem 0; color: #28a745; font-weight: bold;">
                  One item in your order is out for delivery!
                </p>
              {% endif %}
            {% endif %}
          </td>
        </tr>
      </table>

      <!-- Delivery Date Banner -->
      {% if fulfillment.estimated_delivery_at %}
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: linear-gradient(135deg, #28a745, #34ce57);
          color: #fff;
        ">
        <tr align="center">
          <td style="padding: 1.5rem">
            <h2 style="margin: 0; font-size: 1.5rem;">
              📅 Expected Delivery: {{ fulfillment.estimated_delivery_at | date: format: 'date' }}
            </h2>
            <p style="margin: 0.5rem 0 0 0; font-size: 1.1rem;">
              Your beautiful jewelry will arrive soon!
            </p>
          </td>
        </tr>
      </table>
      {% endif %}

      <!-- Order Details -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
        ">
        <tr>
          <td style="padding: 1rem 2rem">
            <h3 style="color: #cfa96b">Delivery Details:</h3>
            <p>
              <strong>Order Number:</strong> {{ order_name }}<br>
              {% if po_number %}
                <strong>PO Number:</strong> #{{ po_number }}<br>
              {% endif %}
              <strong>Status:</strong> <span style="color: #28a745; font-weight: bold;">Out for Delivery</span>
            </p>
          </td>
        </tr>
      </table>

      <!-- Tracking Information -->
      {% if fulfillment.tracking_numbers.size > 0 %}
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #cfa96b;
          color: #fff;
        ">
        <tr>
          <td style="padding: 2rem">
            <h3>📦 Track Your Delivery in Real-Time</h3>
            {% if fulfillment.tracking_numbers.size == 1 and fulfillment.tracking_company and fulfillment.tracking_url %}
              <p>
                <strong>{{ fulfillment.tracking_company }} Tracking Number:</strong><br>
                <a
                  href="{{ fulfillment.tracking_url }}"
                  style="
                    color: white;
                    text-decoration: underline;
                    font-size: 1.2rem;
                    font-weight: bold;
                  "
                  >{{ fulfillment.tracking_numbers.first }}</a>
              </p>
              <p style="margin-top: 1rem; font-size: 0.9rem;">
                💡 Tip: Save this tracking link to monitor your delivery progress!
              </p>
            {% elsif fulfillment.tracking_numbers.size == 1 %}
              <p>
                <strong>Tracking Number:</strong><br>
                <span style="font-size: 1.2rem; font-weight: bold;">{{ fulfillment.tracking_numbers.first }}</span>
              </p>
            {% else %}
              <p><strong>{{ fulfillment.tracking_company }} Tracking Numbers:</strong></p>
              {% for tracking_number in fulfillment.tracking_numbers %}
                <p>
                  {% if fulfillment.tracking_urls[forloop.index0] %}
                    <a
                      href="{{ fulfillment.tracking_urls[forloop.index0] }}"
                      style="
                        color: white;
                        text-decoration: underline;
                        font-size: 1.1rem;
                        font-weight: bold;
                      "
                      >{{ tracking_number }}</a>
                  {% else %}
                    <span style="font-size: 1.1rem; font-weight: bold;">{{ tracking_number }}</span>
                  {% endif %}
                </p>
              {% endfor %}
            {% endif %}
          </td>
        </tr>
      </table>
      {% endif %}

      <!-- Action Button -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
        ">
        <tr align="center">
          <td style="padding: 2rem">
            {% if order_status_url %}
              <a
                href="{{ order_status_url }}"
                style="
                  background: #28a745;
                  color: #fff;
                  padding: 1rem 3rem;
                  border-radius: 5px;
                  text-decoration: none;
                  font-size: 1.25rem;
                  font-weight: bold;
                  display: inline-block;
                  margin-bottom: 1rem;
                  box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
                "
                >Track My Delivery</a>
            {% else %}
              <a
                href="{{ shop.url }}"
                style="
                  background: #cfa96b;
                  color: #fff;
                  padding: 1rem 3rem;
                  border-radius: 5px;
                  text-decoration: none;
                  font-size: 1.25rem;
                  font-weight: bold;
                  display: inline-block;
                  margin-bottom: 1rem;
                "
                >Visit Our Store</a>
            {% endif %}
            <br>
            <a
              href="{{ shop.url }}"
              style="color: #cfa96b; text-decoration: none; font-size: 1rem;"
              >Continue Shopping</a>
          </td>
        </tr>
      </table>

      <!-- ITEMS OUT FOR DELIVERY -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
        ">
        <tr>
          <td colspan="2" style="padding: 1rem 2rem;">
            <h2 style="color: #cfa96b; margin: 0">Coming to You Today:</h2>
          </td>
        </tr>
        {% for line in fulfillment.fulfillment_line_items %}
        <tr>
          <td style="padding: 1rem; text-align: center">
            {% if line.line_item.image %}
              <img src="{{ line.line_item.image | img_url: '300x' }}" style="border-radius: 8px; max-width: 100%; height: auto;" />
            {% else %}
              <div style="width: 300px; height: 300px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <span style="color: #999;">No Image</span>
              </div>
            {% endif %}
          </td>
          <td style="padding: 1rem 2rem">
            {% if line.line_item.presentment_title %}
              {% assign line_title = line.line_item.presentment_title %}
            {% elsif line.line_item.title %}
              {% assign line_title = line.line_item.title %}
            {% else %}
              {% assign line_title = line.line_item.product.title %}
            {% endif %}
            
            {% if line.quantity < line.line_item.quantity %}
              {% capture line_display %}
                {{ line.quantity }} of {{ line.line_item.quantity }}
              {% endcapture %}
            {% else %}
              {% assign line_display = line.line_item.quantity %}
            {% endif %}

            <p><strong>{{ line_title }}</strong></p>
            {% if line.line_item.variant.title != 'Default Title' %}
              <p style="color: #666;">{{ line.line_item.variant.title }}</p>
            {% endif %}
            {% if line.line_item.sku %}
              <p style="color: #666; font-size: 0.9rem;">SKU: {{ line.line_item.sku }}</p>
            {% endif %}
            <p><strong>QTY:</strong> {{ line_display }}</p>
            
            {% if line.line_item.selling_plan_allocation %}
              <p style="color: #cfa96b; font-weight: bold;">{{ line.line_item.selling_plan_allocation.selling_plan.name }}</p>
            {% endif %}
            
            {% if line.line_item.discount_allocations %}
              {% for discount_allocation in line.line_item.discount_allocations %}
                {% if discount_allocation.discount_application.target_selection != 'all' %}
                  <p style="color: #28a745;">
                    💰 {{ discount_allocation.discount_application.title }}
                    (-{{ discount_allocation.amount | money }})
                  </p>
                {% endif %}
              {% endfor %}
            {% endif %}

            <div style="background: #e8f5e8; padding: 0.5rem 1rem; border-radius: 5px; margin-top: 1rem;">
              <p style="margin: 0; color: #28a745; font-weight: bold; font-size: 0.9rem;">
                🚚 Status: Out for Delivery
              </p>
            </div>
          </td>
        </tr>
        {% endfor %}
      </table>

      <!-- Delivery Preparation Tips -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #e8f4fd;
          border-left: 5px solid #cfa96b;
        ">
        <tr>
          <td style="padding: 1.5rem 2rem">
            <h3 style="color: #cfa96b; margin: 0 0 1rem 0;">🏠 Preparing for Delivery</h3>
            <ul style="margin: 0; padding-left: 1.5rem; color: #666;">
              <li style="margin-bottom: 0.5rem;">📱 Keep your phone handy for delivery notifications</li>
              <li style="margin-bottom: 0.5rem;">🚪 Ensure someone is available to receive the package</li>
              <li style="margin-bottom: 0.5rem;">🏠 Verify your delivery address is clearly marked</li>
              <li style="margin-bottom: 0.5rem;">📦 Have ID ready if signature is required</li>
              <li>⏰ Track your package for real-time updates</li>
            </ul>
          </td>
        </tr>
      </table>

      <!-- Excitement Section -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
          text-align: center;
        ">
        <tr>
          <td style="padding: 2rem">
            <h2 style="color: #cfa96b; margin-bottom: 1rem;">The Moment Is Almost Here! ✨</h2>
            <p style="font-size: 1.1rem; margin-bottom: 1rem; color: #666;">
              Your beautiful jewelry from Malani Jewelers is just hours away. Get ready to unbox something truly special!
            </p>
            <div style="background: linear-gradient(135deg, #cfa96b, #d4b876); color: white; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
              <p style="margin: 0; font-weight: bold;">
                📸 Don't forget to share your unboxing moment and tag us!
              </p>
            </div>
          </td>
        </tr>
      </table>

      <!-- Help Section -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #cfa96b;
          color: #fff;
        ">
        <tr>
          <td style="padding: 2rem">
            <h3>Delivery Questions?</h3>
            <p>
              Visit
              <a
                style="color: white; text-decoration: underline"
                href="{{ shop.url }}/pages/shipping"
                >Shipping & Delivery</a
              >
            </p>
            <p>
              Call:
              <a
                style="color: white; text-decoration: underline"
                href="tel:18880006666"
                >+1 (888) 000-6666</a
              >
            </p>
            <p>
              Email:
              <a
                style="color: white; text-decoration: underline"
                href="mailto:{{ shop.email }}"
                >{{ shop.email }}</a
              >
            </p>
            <p style="margin-top: 1.5rem; font-size: 0.9rem;">
              🕐 <strong>Delivery Hours:</strong> Usually between 9 AM - 8 PM
            </p>
          </td>
        </tr>
      </table>

      <!-- Cross-sell for excitement -->
        <!-- More Items -->
      <table
        style="
          width: 90%;
          max-width: 600px;
          margin: 0 auto;
          background: #fff;
          text-align: center;
        ">
        <tr>
          <td colspan="3">
            <h2 style="padding: 2rem 0">
              While You Wait
            </h2>
          </td>
        </tr>
        <tr>
          <td class="btn">
            <a
              href="{{ shop.url }}/collections/womens-new-arrivals"
              style="
                background: #cfa96b;
                color: #fff;
                padding: 1rem 2rem;
                border-radius: 5px;
                text-decoration: none;
              "
              >Women's New Arrivals</a
            >
          </td>
          <td class="btn">
            <a
              href="{{ shop.url }}/collections/mens-new-arrivals"
              style="
                background: #cfa96b;
                color: #fff;
                padding: 1rem 2rem;
                border-radius: 5px;
                text-decoration: none;
              "
              >Men's New Arrivals</a
            >
          </td>
          <td class="btn">
            <a
              href="{{ shop.url }}/collections/kids"
              style="
                background: #cfa96b;
                color: #fff;
                padding: 1rem 2rem;
                border-radius: 5px;
                text-decoration: none;
              "
              >Kids' Picks</a
            >
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <h3 style="padding-top: 2rem">
              Free Shipping on Orders $750+
            </h3>
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <h3 style="padding-top: 2rem">
              Buy Now, Pay Later with
              <a
                href="{{ shop.url }}/pages/affirm"
                style="color: #cfa96b"
                >Affirm</a
              >
            </h3>
          </td>
        </tr>
      </table>
    </section>
  </body>
</html>